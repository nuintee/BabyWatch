<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BabyWatch</title>
</head>
<body>
    <header>
        <p><small class="latestPlaceHolder">ミルク : 最終更新</small></p>
        <h5 id = "milkLatest"></h5>
        <p><small class = "latestPlaceHolder">オムツ : 最終更新</small></p>
        <h5 id = "diaperLatest"></h5>
    </header>
    <main>
        <button class = "actionBtns">ミルク</button>
        <input id = "milkPortion" type = "number" value = "10" step="10">
        <button class = "actionBtns">オムツ</button>
    </main>
    <footer>
        <select id="form-select">
            <option value="1">Sho</option>
            <option value="2">Non</option>
        </select>
    </footer>
    <script>


        let actionBtns = document.querySelectorAll('.actionBtns');

        for(let i = 0; i < actionBtns.length; i++)
        {
            actionBtns[i].addEventListener('click',check,false);
        }

        function check(e){

            let aciton;
            let milkFlag = false;
            let ask;

            let now = new Date();
            let month = now.getMonth() + 1;
            let date = now.getDate();
            let hour = now.getHours();
            let minutes = now.getMinutes();

            let personIndex = document.getElementById("form-select").options;
            let who = personIndex[ personIndex.selectedIndex ].innerText;
            let when = `${month}%2F${date} ${hour}:${minutes}`.toString();
            let what = e.toElement.innerText;
            let how = document.getElementById("milkPortion").value;

            //Action 選定
            if (what == 'ミルク'){ 
                action = "あげ"
                milkFlag = true;
            }
            else { action = "替え" };

            //量が要るか判定
            if ( milkFlag == true){
                ask = confirm(`${who}さんが${what}を${month}/${date} ${hour}:${minutes}に${how}ml${action}ました。`)
            }
            else {
                ask = confirm(`${who}さんが${what}を${month}/${date} ${hour}:${minutes}に${action}ました。`)
            }

            // askの結果によるページネーション
            if (ask == false) return;

            fetch(`/api/${who}/${when}/${what}/${how}`).then(
                console.log('Checked to spreadsheet!')
            );

            //Clear Input
            document.getElementById("milkPortion").value = 10;


            // .then(response => response.text())
            // .then(data => console.log(data));
        }
    </script>
</body>
</html>