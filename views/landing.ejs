<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BabyWatch</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
</head>
<body>
    <header>
        <p class="latestPlaceHolder">ミルク : 最終更新</p>
        <h6 id = "milkLatest">
            <% if (data != 0) { %>
                <% let milkIndex = 0 %>
                <% for (let i = 0; i < data.length; i++) { %>
                    <% if (data[i].what == 'ミルク') { %>
                        <% milkIndex = i %>
                    <% } %>
                <% } %>
                <%= `${data[milkIndex].when} - ${data[milkIndex].who} (${data[milkIndex].portion}ml)` %>
            <% } else { %>
                まだデータがありません
            <% } %>
        </h6>
        <p class = "latestPlaceHolder">オムツ : 最終更新</p>
        <h6 id = "diaperLatest">
            <% if (data != 0) { %>
                <% let diaperIndex = 0 %>
                <% for (let i = 0; i < data.length; i++) { %>
                    <% if (data[i].what == 'オムツ') { %>
                        <% diaperIndex = i%>
                    <% } %>
                <% } %>
                <%= `${data[diaperIndex].when} - ${data[diaperIndex].who}` %>
            <% } else { %>
                まだデータがありません
            <% } %>
        </h6>
    </header>
    <main>
        <form action = "/api" method = "POST">
            <input type = "submit" class = "actionBtns" name = "what" value = "ミルク" onsubmit="check(this)">
            <input id = "milkPortion" type = "number" value = "10" step="10" name = "portion">
            <input type= "submit" class = "actionBtns" name = "what" value="オムツ" onsubmit="check(this)">
            <div>
                <select id="form-select" name = "who">
                    <option value="Sho" name = "Sho">Sho</option>
                    <option value="Non" name = "Non">Non</option>
                </select>
            </div>
        </form>
    </main>
    <table class = "table table-striped">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">誰が</th>
                <th scope="col">何時に</th>
                <th scope="col">何をした</th>
                <th scope="col">どのくらい？(任意)</th>
            </tr>
        </thead>
        <tbody>
            <%for (let i = 0; i < data.length; i++)  {%>
            <tr>
                <th scope="row"><%= i + 1 %></th>
                <td><%= data[i].who%></td>
                <td><%= data[i].when%></td>
                <td><%= data[i].what%></td>
                <td>
                    <% if (data[i].what == 'ミルク') { %>
                    <%=     data[i].portion%><small>ml</small>
                    <% };%>
                </td>
            </tr>
            <%} %> 
        </tbody>
    </table>
    <script>

        // let actionBtns = document.querySelectorAll('.actionBtns');

        // for(let i = 0; i < actionBtns.length; i++)
        // {
        //     actionBtns[i].addEventListener('click',check,false);
        // }

        // function check(e){

        //     let aciton;
        //     let milkFlag = false;
        //     let ask;

        //     let now = new Date();
        //     let month = now.getMonth() + 1;
        //     let date = now.getDate();
        //     let hour = now.getHours();
        //     let minutes = now.getMinutes();

        //     let personIndex = document.getElementById("form-select").options;
        //     let who = personIndex[ personIndex.selectedIndex ].innerText;
        //     let when = `${month}%2F${date} ${hour}%3A${minutes}`.toString();
        //     let what = e.toElement.innerText;
        //     let how = document.getElementById("milkPortion").value;

        //     //Action 選定
        //     if (what == 'ミルク'){ 
        //         action = "あげ"
        //         milkFlag = true;
        //     }
        //     else { action = "替え" };

        //     //量が要るか判定
        //     if ( milkFlag == true){
        //         ask = confirm(`${who}さんが${what}を${month}/${date} ${hour}:${minutes}に${how}ml${action}ました。`)
        //     }
        //     else {
        //         ask = confirm(`${who}さんが${what}を${month}/${date} ${hour}:${minutes}に${action}ました。`)
        //     }

        //     // askの結果によるページネーション
        //     if (ask == false) return;

        //     fetch(`/api/${who}/${when}/${what}/${how}`);

            //Clear Input
            //document.getElementById("milkPortion").value = 10;


            // .then(response => response.text())
            // .then(data => console.log(data));
        //}
    </script>
</body>
</html>